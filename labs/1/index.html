<div id=table>
    <div class="row header">
        <input value="" readonly>
        <input value=A readonly>
        <input value=B readonly>
        <input value=C readonly>
    </div>
    <div class=row>
        <input value=1 class=header readonly>
        <input data-cell=A1>
        <input data-cell=B1>
        <input data-cell=C1>
    </div>
    <div class=row>
        <input value=2 class=header readonly>
        <input data-cell=A2>
        <input data-cell=B2>
        <input data-cell=C2>
    </div>
    <div class=row>
        <input value=3 class=header readonly>
        <input data-cell=A3>
        <input data-cell=B3>
        <input data-cell=C3>
    </div>
</div>
<button id=save type=button> Save </button>

<script>
    "use strict";

    document.getElementById("table").addEventListener("keydown", event => {
        if (event.key === "Enter") {
            if (event.target.readOnly) {
                event.target.readOnly = false;
                event.target.dataset.value = event.target.value;
                event.target.value = event.target.dataset.expression;
            } else {
                event.target.readOnly = true;
                event.target.dataset.expression = event.target.value;

                ipc.requestEvaluation(event.target.dataset.cell, event.target.value);
            }
        }
    });

    document.getElementById("save").addEventListener("click", event => {
        ipc.requestSave();
    });

    ipc.handleEvaluated((event, cell, value) => {
        const input = document.querySelector(`[data-cell=${cell}]`);
        input.dataset.value = value;
        if (input.readOnly) {
            input.value = value;
        }
        input.classList.remove("error");
    });

    ipc.handleRejected((event, cell, message) => {
        const input = document.querySelector(`[data-cell=${cell}]`);
        input.dataset.value = message;
        if (input.readOnly) {
            input.value = message;
        }
        input.classList.add("error");
    });
</script>

<style>
    html, body, table {
        margin: 0;
    }

    * {
        font-size: 20;
    }

    .row {
        display: flex;
    }

    .header input, input.header {
        background-color: cyan !important;
        text-align: center;
    }

    input {
        flex: 1 1 0;
        min-width: 0;
    }

    input[readonly] {
        background-color: lightgray;
    }

    input[readonly].error {
        background-color: red;
    }
</style>
